<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Reconciliation Service</title>
    
    <link rel="stylesheet" href="lib/dataTables/media/css/demos.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="lib/jquery.ui/themes/cupertino/ui.all.css" type="text/css" media="screen" title="Cupertino" charset="utf-8">
    <link rel="stylesheet" href="lib/progressbar/progressbar.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="lib/suggest/freebase-controls.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="lib/suggest/jquery.freebase.minitopic.css" type="text/css" media="screen" charset="utf-8">

    <link rel="stylesheet" href="recon.css" type="text/css" media="screen" charset="utf-8">

    <script type="text/javascript" language="javascript" src="lib/json2.js"></script>
    <script type="text/javascript" language="javascript" src="lib/jquery.js"></script>
    <script type="text/javascript" language="javascript" src="lib/jquery.ui/ui/ui.core.js"></script>
    <script type="text/javascript" language="javascript" src="lib/jquery.ui/ui/ui.tabs.js"></script>
    <script type="text/javascript" language="javascript" src="lib/dataTables/media/js/jquery.dataTables.js"></script>
    <script type="text/javascript" language="javascript" src="lib/progressbar/jqueryprogressbar.js"></script>
    <script type="text/javascript" language="javascript" src="lib/suggest/jquery.freebase.minitopic.js"></script>
    <script type="text/javascript" language="javascript" src="lib/suggest/freebase.suggest.js"></script>

    <script type="text/javascript" language="javascript" src="recon.js"></script>
    <script type="text/javascript" language="javascript" src="sampledata.js"></script>
    <script type="text/javascript" language="javascript" charset="utf-8">
    
        var currentRow = null;
        var currentManualReconRoad = null;
        var tabs;
        var spreadSheetData = null;
        var spreadSheetTable;
        var currentReconRowId = -1;

        function handleNewSpreadsheet()
        {
            $('#spreadsheetDiv').show();
            parseSpreadsheet($('#spreadsheet')[0].value)
            //initialize some tracking variables
            totalRecords = rows.length;
            remainingAutoRec = totalRecords;


            spreadSheetData = {"aoColumns":[], "aaData":rows};
            for (var i = 0; i < headers.length; i++)
                spreadSheetData["aoColumns"].push({"sTitle":headers[i]});

            updateUnreconciledCount();
            spreadSheetData["bAutoWidth"] = false
            spreadSheetData["bSort"] = false
            spreadSheetTable = $('#spreadsheetTable').dataTable(spreadSheetData)
            $('#spreadsheetInput').hide();
            tabs = $("#tabs > ul");
            tabs.tabs();
            tabs.bind("tabsselect", function(event, ui) {
                if(ui.index == 1) manualReconcile();
                else if (ui.index == 2) renderSpreadsheet();
            });
            $("#tabs").show();
            tabs.tabs("select", 0);
        }

        $(document).ready(function() {
            $(".invisible").hide();
            jQuery.ajaxSettings.cache = true; //keeps jquery from inserting cache-busting timecodes into json requests
            
            setReconciliationURL();
            
            //handle the options panel
            $("#optionsPanel input").each(function(idx, input) {
              $(input).change(function(){
                eval(input.id + '="' + input.value + '"');
              });
              input.value = eval(input.id);
            });
            
            $("#find_topic")
              .freebaseSuggest()
              .bind("fb-select", function(e, data) { 
                handleReconChoice(data.id);
              });
        });
    </script>
</head>
<body id="dt_example">
    <div id='main_app'>
      <div id="spreadsheetInput" class="container">
          <b>Copy your spreadsheet here:</b><br/>
          <textarea rows="15" cols="80" name="spreadsheet" id="spreadsheet"></textarea><br/>
          <button onclick="handleNewSpreadsheet()">Parse Spreadsheet</button>
          <button onclick="$('#spreadsheet')[0].value = sampleData">Sample Data</button>
          <p/>
      </div>
    
      <div id="tabs" class="invisible">
          <ul>
              <li><a href="#spreadsheetPreview"><span>Browse Data</span></a></li>
              <li><a href="#spreadsheetReconcile"><span>Reconcile Record <span class="manual_count">(0)</span></span></a></li>
              <li><a href="#spreadsheetRender"><span>Retrieve Spreadsheet</span></a></li>
          </ul>


          <div id="spreadsheetPreview" class="container">
              <div id="spreadsheetDiv" class="container invisible">
                <table cellpadding="0" cellspacing="0" border="0" class="display" id="spreadsheetTable"></table>
                <br/>
                <button class='notReconciling' onclick="beginAutoReconciliation()">Auto-Reconcile</button>
                <button class='nowReconciling invisible' onclick="stopReconciliation()">Stop Auto-Reconciliation</button>
              </div>
          </div>

          <div id="spreadsheetReconcile" class="container">
              <div id="reconcileDiv" class="container">Loading... <img src='spinner.gif'></div>
              <div id="additionalReconcile" class='invisible'>
                <label for="find_topic">Find Topic:</label><input type="text" name="find_topic" id="find_topic">
              </div>
          </div>

          <div id="spreadsheetRender" class="container">
              <b>Copy your updated spreadsheet from here:</b><br/>
              <textarea rows="15" cols="80" name="outputSpreadSheet" id="outputSpreadSheet"></textarea><br/>
              <p/>
          </div>
      </div>
      <div id="progresscontainer" class="nowReconciling invisible">
        <div id='progressbar'></div>
      </div>
      
      <a href="#optionsPanel" class='optionsButton' onClick='$("#main_app").hide();$("#optionsPanel").show(); return false;'>Options</a>
    </div>
    <div id="optionsPanel" class='invisible container'>
      <label for="reconciliation_url">Reconciliation URL: </label><input type="text" name="reconciliation_url" value="" id="reconciliation_url" size='60'><br/>
      <label for="freebase_url">Freebase URL: </label><input type="text" name="freebase_url" value="" id="freebase_url" size='60'><br/>
      <button onClick='$("#optionsPanel").hide();$("#main_app").show();'>Ok</button>
    </div>
</body>
</html>